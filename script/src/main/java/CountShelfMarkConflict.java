import com.google.common.collect.Lists;
import common.enums.ShelfMarkTypeEnum;
import common.utils.dbMgr.LayoutShelfUtils;
import common.utils.dbMgr.ShopLayoutUtils;
import model.LayoutShelf;

import java.util.List;

/**
 * @description: 检测门店中货架标记冲突
 * @author: yulong.cao
 * @since: 2020-12-30 11:10
 **/
public class CountShelfMarkConflict {

    private static final List<Integer> needToFlushToShelfTypeMark = ShelfMarkTypeEnum.getAllCodes();

    public static void main(String[] args) {
        List<String> shopCodes = Lists.newArrayList("100001001","100001002","100016001","100010001","100006003","100017003","100057002","100002002","100030001","100070001","100008002","100051002","100011001","100022001","100002003","110001006","100001016","110001005","100001053","123001025","123001022","100001131","101001021","100071008","110001053","110001057","101001033","100001117","100079015","101001059","100001118","100000053","100000023","101001038","100001059","123000023","123000022","100000085","123000008","110000013","123000038","100000118","123000059","123000068","100001115","123000062","123000067","100000017","123000061","110000026","123000078","101000088","123000086","110001039","100000103","110000020","100000185","123001039","100000178","123001009","100000193","109000003","100000110","110000066","111000005","110000068","123000107","118000005","109000005","101000106","100000288","100000282","100000315","100000318","100000259","111000015","100000331","100000329","100000322","100000332","100000309","101000133","100000336","101000135","100000359","100000323","100000360","109000020","101000109","100000381","101000151","109000027","100000529","109000028","100000535","100000559","100000531","100000396","100000569","100000596","101000179","100000576","100000593","100000586","109000037","101000170","101000175","100000595","100000611","101000197","101000199","100000591","100000618","100000615","100000379","100000605","101000187","109000051","109000052","108000001","107000007","108000002","101000225","109000059","101000203","100000623","100000683","110001008","110001007","100072001","101001017","110001036","110001052","101001028","101000050","100079010","101001063","101000039","110000010","100000119","100000086","123000026","123000055","123000027","100000102","100000130","101000071","123000033","123000072","101000075","100000116","100000109","100000113","123000031","101000093","110000058","123000095","100000160","111000003","100000206","123000112","110000072","101000107","111000008","100000233","109000007","123000156","100000175","100000278","118000009","123000160","100000287","101000110","110000088","100000290","110000089","100000295","123000135","100000292","110000081","100000280","100000306","100000316","100000338","101000153","100000372","100000373","100000369","101000132","109000025","101000158","100000523","101000160","100000527","100000333","101000167","100000572","101000103","101000105","111000010","101000138","100000517","100000570","101000173","109000036","100000617","101000193","100000626","101000201","101000206","100000597","100000616","100000561","100000652","101000189","100000532","100000636","100000620","100000631","101000210","100000612","101000213","100000657","101000217","101000202","109000057","100000663","101000220","123000180","107000008","109000031","107000012","101000137","107000011","109000061","100000655","109000062","100000635","107000003","107000016","107000013","108000015","100000675","107000025","100002001","100033002","100027001","100033006","100051003","100003006","100058001","100001029","100001033","100001011","100001023","100001039","123001007","100001061","100001036","100001051","110001010","100063001","100001073","100001066","100001091","100001099","100001082","101001022","100001120","100001055","100001106","123001031","101001016","101001020","100001126","100072007","123001032","100072009","100073002","101001029","100075002","100077003","123001033","110001029","100073008","123001037","100073009","100077007","100072006","100075006","100073001","123001050","100076001","123001065","101001053","100075007","110001061","100000002","123001062","101000051","101001055","100076005","100071003","100000028","101000053","100079001","101000056","123000006","100000037","101000069","123001005","100000076","123000007","101000070","100000057","100079005","123000011","101001052","100000079","100000012","110001063","100000066","123000037","100001026","100000030","100000087","110000009","100000025","101000076","100076007","100000063","110000023","100079006","123000035","100000101","100000020","100000090","100000106","100000136","100000137","110000030","110000038","110000050","110000039","100079033","123000082","101000089","100000179","100000128","110001031","100000151","123000091","101000080","100000083","100079002","100000207","123000099","101000061","110000059","100000221","100000211","110000069","100000229","123000110","100000165","123000103","100000035","123000116","100000228","123000133","123000126","100000168","100000226","100000260","101000108","100000291","101000112","123000137","100000266","110000090","109000016","100000519","100000363","101000169","100000371","101000176","100000607","110000067","100000650","109000053","100000666","107000009","100000395","108000011","101000219","107000015","100000660","101000233","108000016","100000681","107000027","100000520","100000686","100001005","100017002","100019002","100023001","100009001","100002006","100002007","100008003","101001007","188001009","100001062","100001037","100001083","100001096","100001093","100001102","100001108","100022002","100001063","110001022","100001125","100071006","110001030","110001033","101001027","100001127","100073007","123001056","100077008","188001011","110000005","123001076","123001020","100000050","100000003","101000057","100000009","123000009","100078001","100000055","123000019","101000079","123000050","100000008","123000065","123000010","101000059","100000120","100000133","123000066","123000070","100000138","100000129","100000029","100000166","110000031","118000002","100000093","123000081","110000051","109000002","123000092","100000201","100000196","118000003","100000158","100000251","100000220","123000123","100000273","100000268","123000132","101000092","100000298","109000010","100000299","109000013","101000113","100000276","100000271","123000153","101000131","101000128","109000019","100000366","109000021","101000129","100000098","100000356","100000376","101000159","100000352","100000380","100000301","100000518","100000510","100000367","100000507","100000382","100000521","100000566","100000598","100000575","101000177","100000538","100000582","101000180","100000589","100000627","101000188","100000608","109000023","100000560","100000630","100000573","101000211","101000208","107000001","100000516","101000222","101000221","108000003","107000006","100000509","100000638","107000020","100000659","100000670","101000232","100000687","100001003","100006001","100006002","100005002","100011005","100016003","110001002","100001025","123001003","100001065","100001038","188001006","100001088","110001015","110001019","100001058","123001026","100001111","123001036","100001090","110001058","110001060","100077009","100001107","123001063","100079021","101000063","100000018","110000012","100000061","123000013","101000060","100079016","100000058","100000059","123000029","100075009","110000008","100000026","100000107","100000031","123000012","101000065","100000021","100000072","123000058","110000015","100000060","100000062","100000089","101000083","101000068","100000082","123000057","100000139","123000036","100000105","123000071","110000028","100000170","100000169","123001077","100079003","100000056","123000085","100000182","123000088","110000053","100000190","101000090","123000090","100000195","110000062","123000097","100000167","123000115","100000238","100000199","110000071","100000267","100000262","123000129","109000006","123000111","123000101","100000163","101000115","109000012","100000289","100000302","100000283","100000285","100000317","109000015","101000123","100000325","100000330","100000321","100000319","100000351","101000127","100000370","100000515","101000157","100000320","100000386","100000171","100000536","100000565","101000161","101000139","109000030","101000062","100000557","100000558","101000192","109000050","100000603","101000168","101000212","100000530","101000218","100000639","100000375","109000056","101000223","108000006","100000668","107000022","107000023","100000667","100000581","101000236","100003001","100016002","100051001","100036001","100011006","100037001","100008001","100035001","100061001","100003005","100011003","100033005","100001013","110001003","100001030","100001020","100001035","100001050","100001081","100001052","100001018","101001006","100001070","101001010","100001086","100001071","100001072","100001077","100001079","100001109","100001110","100001075","123001012","123001015","101001013","110001020","110001023","100001112","123001018","123001002","100001123","101001009","101001025","110001027","100001129","100072008","100072005","100075001","110001038","110001056","100071007","100073005","100075003","100071005","100078003","101001036","101001037","100079018","100075008","123001068","110000002","100079011","110001062","100079017","110000006","100076008","123001078","101000067","123001059","123000018","101000066","100000075","100000078","100000052","123000017","100000068","100076003","100000092","100000077","101000077","100079023","110000016","100000033","100000070","123000052","123000060","100000096","123000015","101000085","100000022","100000073","100000183","123000083","100000176","100000173","100000172","123000087","110000055","110000056","110000057","100000108","100000180","100000218","101000095","100001105","101000102","100000263","110000070","100000256","100000250","100000225","123000108","111000007","100000235","100000237","123000138","100000261","123000139","100000270","101000111","123000118","123000125","100000327","100000313","100000337","100000210","100000579","100000601","101000181","109000039","101000190","107000002","101000198","100000633","109000055","108000007","101000186","108000008","109000060","108000012","100000508","101000228","100001007","100003003","100003002","100019001","100010002","100019005","100023002","100023003","100023006","100031001","100033003","100001009","100025002","100011007","100001019","101001005","100001028","100001068","100001031","100001032","188001005","100001057","100001095","100001119","123001021","110001025","123001029","100001128","101001026","100073006","101001035","100076009","110001050","123001058","123001060","100077005","123001061","101001057","100078006","100079008","110000065","100079013","123001073","123001067","100000005","100076002","100000007","101001056","100079020","100077006","123000005","100000069","100001076","100000080","100000088","110000017","123000028","101000073","123000030","101000082","100000097","123000069","110000025","100000150","123000077","100000071","118000001","110001059","123000080","100000067","100000132","100000135","100000162","100000186","123000075","110000060","123000098","100000217","110000061","123000109","123000096","100000232","118000006","100000269","123000155","109000008","100000279","100000296","109000009","101000116","100000281","100000305","100000339","100000311","100000350","100000326","101000130","123000127","100000357","109000017","101000121","100000358","109000022","109000026","100000297","100000365","100000526","100000308","100000556","100000377","100000533","100000258","101000166","101000162","100000562","100000571","109000032","100000505","100000567","100000537","100000619","101000183","100000628","101000182","101000207","100000590","107000005","101000191","108000005","100000610","107000017","107000021","101000231","100000651","101000235","100000682","108000013","100001006","100017005","100022005","100071001","100001010","100001027","110001011","123001011","100002008","100002009","100001067","100001069","100001078","188001003","100001060","101001011","123001013","100001092","123001028","100001121","100001130","100001087","100071009","101001032","123001055","100001103","123001051","123001057","101001018","101001039","123001038","100078005","100077002","101001060","101000052","100079012","123001080","100000019","100000027","100079019","100000013","123001079","123000021","100000015","110000011","100000095","100000111","123000063","100079022","100000091","100000125","123000073","100000152","100000121","100000127","110000021","100000153","100000155","123000076","101000086","100000112","100000159","100000117","123000079","100000177","100000099","110000032","100000181","110000033","100000187","100000198","109000001","100000189","100000213","100000039","123000102","123000106","100000219","100000215","100000252","100000255","100000231","100000272","100000286","123000121","101000101","100000236","123000150","100000212","101000117","100000310","100000081","101000125","101000119","100000328","100000335","101000091","109000018","100000197","101000156","100000257","100000525","109000029","100000378","109000033","101000150","100000239","100000275","100000587","101000171","100000599","101000185","100000609","101000178","109000038","101000195","100000625","100000629","101000196","109000058","107000010","101000215","108000010","107000019","101000226","101000230","100000622","101000136","107000018","100000669","108000019","100000242","100057001","100000126","123001035","110001051","123000001","123000051","123000056","123000039","123000053","111000006","123000113","123000152","123000170","123000163","110000093","118000010","123000179","123000182","123000183","123000189","123000190","111000018","110000107","123000257","123000230","123000278","110000113","397000003","111000021","111000025","123000281","232000002","111000026","397000008","118000021","118000022","232000005","123000339","612000010","115000003","233000003","127000002","115000008","115000015","115000012","110000161","111000053","109000066","121000002","110000163","121000007","121000010","109000070","121000016","125000007","612000016","123000025","110000037","110000073","123000131","110000082","123000165","110000097","118000011","123000251","111000020","123000265","118000016","123000266","123000250","111000019","118000017","123000273","110000120","123000268","397000007","123000302","123000296","123000297","123000301","123000311","110000128","118000020","176000005","123000293","612000005","110000136","123000316","123000318","123000322","123000325","118000023","123000331","612000008","111000032","123000335","123000336","123000332","111000035","111000037","110000139","110000150","118000026","118000027","110000157","123000357","115000010","123000352","123000351","110000162","612000015","118000025","115000017","123000362","109000068","123000353","121000009","110000167","109000067","109000072","121000019","123001001","110001001","123001027","123001023","123001052","123000119","123000122","123000136","110000077","123000158","123000168","110000106","110000108","110000105","118000012","110000126","123000310","123000358","127000003","111000051","127000005","127000007","123000365","110000165","110000003","123001016","111000001","123000161","110000085","111000011","123000171","123000225","123000227","123000236","110000103","110000092","123000237","123000271","123000272","123000282","123000255","110000087","123000292","176000003","123000288","123000277","118000019","123000290","123000279","233000001","123000298","110000129","123000321","110000132","123000317","612000003","111000029","612000007","110000135","132000005","232000008","115000005","111000036","110000156","115000016","118000030","110000160","123000360","121000005","111000055","123000363","118000032","127000008","110000110","127000009","127000010","232000010","123000369","115000023","110000007","123000020","123000016","111000002","123000162","123000169","110000091","123000188","123000178","123000223","123000195","110000109","118000015","123000228","123000238","397000001","123000262","110000115","176000002","111000023","123000275","110000095","232000001","118000018","110000125","123000285","123000295","111000027","123000299","123000261","123000312","123000315","111000030","111000031","123000327","123000309","111000033","115000002","612000011","123000350","115000009","123000176","118000029","109000065","121000001","127000006","123000226","108000017","121000013","121000006","109000071","123001006","110001016","123001030","110001017","110000063","123000105","123001066","123000120","110000083","110000079","123000167","110000086","123000175","110000078","123000166","123000192","110000080","111000017","397000002","123000235","110000121","132000002","123000328","176000007","397000010","232000007","612000012","397000011","111000050","176000008","125000002","612000013","123000326","111000056","111000057","123000356","110000166","125000005","612000019","110000001","123001071","123001075","123000089","123000130","118000007","123000159","111000012","123000177","111000013","110000101","110000098","123000191","111000016","110000111","123000253","123000231","123000185","123000263","110000118","397000005","397000006","123000286","132000001","232000003","612000002","110000119","123000319","110000131","176000006","123000338","612000009","123000313","110000123","110000155","233000002","233000005","127000001","110000158","123000239","109000063","111000052","121000003","115000018","110000152","109000069","123000361","121000008","121000015","110001026","123001053","123000003","123000032","110000036","123000117","123000172","123000186","123000187","110000096","110000102","123000181","123000229","110000075","118000013","123000256","123000267","110000117","123000270","123000193","110000116","123000283","123000291","123000308","111000022","110000130","612000001","123000289","110000122","123000276","123000320","123000323","123000330","612000006","123000337","110000138","110000151","111000038","110000153","115000007","132000003","115000013","118000031","123000359","612000017","232000009","121000012","110000137","118000033","101000081","101001015","101000163","101001062","101000172","101000055","101000058","101000126","110000168","123000368","101000227","115000022","100000522","121000018","110000133","100000661","100000688","123000367","101000251","127000011","123000355","123000093","101000237","101000239","109000075","115000020","121000017","612000020","123000371","107000030","109000073","125000009","100000696","115000025","108000021","612000018","111000058","100000689","100000693","612000021","125000008","115000026","115000027","107000032","100000697","110000052","123000287","101000205","100000632","115000006","100000665","101000229","100000673","100000695","110000169","123000372","121000022","101000253","100001136","100001137","121000025","612000023","123000373","115000028","111000059","107000033","115000029","123000375","107000035","101000255","127000012","100001151","107000036","123000376","108000023","612000025","127000013","121000027","121000029","101000257","123000378","115000030","127000015","176000010","176000011","107000037","110000171","127000017","101000118","123000329","100000662","121000011","108000018","108000020","125000006","115000021","100001150","123000377","115000031","100001155","101000260","101000262","109000076","121000030","123000381","121000033","100001187","100000653","101000238","123000370","107000028","121000020","121000021","101000252","107000031","101000256","127000016","100001153","115000032","121000031","121000032","107000039","100001183","107000051","115000033","107000052","123000385","100000602","110000172","115000019","100000685","123000366","121000026","121000028","100001178","100001179","100001185","107000050","125000012","108000025","100001189","100001190","121000035","109000077","111000060","612000026","107000055","107000053","110000176","127000018","100001219");
        shopCodes.parallelStream()
                .forEach(it -> {
                    checkShelfMarkConflict(it);
                });
    }
    /**
     * 检测门店冲突
     * @param shopCode
     */
    private static void checkShelfMarkConflict(String shopCode){
        Integer craftShopLayoutId = ShopLayoutUtils.queryCraftId(shopCode);
        if(craftShopLayoutId != null){
            checkShelfMarkConflict(craftShopLayoutId);
        }

        Integer shopLayoutId = ShopLayoutUtils.queryLatestPublishedId(shopCode);
        if(shopLayoutId != null){
            checkShelfMarkConflict(shopLayoutId);
        }
    }

    private static void checkShelfMarkConflict(Integer shopLayoutId){
        List<LayoutShelf> layoutShelves = LayoutShelfUtils.listByShopLayoutId(shopLayoutId);
        for (LayoutShelf layoutShelf: layoutShelves){
            List<Integer> shelfMarkList = layoutShelf.getShelfMarkList();
            if(shelfMarkList == null || shelfMarkList.isEmpty()){
                continue;
            }
            int i = 0;
            for(Integer shelfMark: shelfMarkList){
                if(needToFlushToShelfTypeMark.contains(shelfMark)){
                    i++;
                }
            }

            if(i > 1){
                String msg = layoutShelf.getShopCode() + "," + layoutShelf.getShelfName();
                System.out.println(msg);
            }
        }
    }
}
